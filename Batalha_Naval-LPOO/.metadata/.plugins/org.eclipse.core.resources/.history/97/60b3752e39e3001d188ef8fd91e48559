package upe.poli.games;

import java.util.Scanner;

import javax.swing.JFrame;
import javax.swing.JOptionPane;

import upe.poli.games.GUI.TabuleiroGUI;
import upe.poli.games.excecoes.EntradaInvalidaExcecao;

public class Game {
    private Jogador[] jogadores;

    public Game(Jogador[] jogadores) {
        this.jogadores = jogadores;
    }

    public  void start(){ 
        Scanner scanner = new Scanner(System.in);

        for (Jogador jogador : jogadores) {
            System.out.println("Jogador " + jogador.getNome() + " posicione seus barcos.");
            jogador.posicionarNavios();

        }

        boolean gameOver = false;
        Jogador jogador1 = jogadores[0];
        Jogador jogador2 = jogadores[1];
        
        while (!gameOver) {
            jogador1.getJanelaJogo().setVisible(true);
            jogador1.getJanelaJogo().setExtendedState(JFrame.NORMAL);

            int x = -1, y = -1;
            char z;

            do {
                JPanel panel = new JPanel(new GridLayout(size, size));
                for (int i = 0; i < size; i++) {
                    for (int j = 0; j < size; j++) {
                        JButton button = new JButton();
                        button.setPreferredSize(new Dimension(50, 50));
                        button.addActionListener(e -> {
                            int row = panel.getComponentZOrder(button) / size;
                            int col = panel.getComponentZOrder(button) % size;
                            if (jogador2.getGrelhaDeDefesa().getGrelha()[row][col] == 2) {
                                JOptionPane.showMessageDialog(null, "Posição já acertada, escolha uma nova posição.");
                            } else if (jogador2.getGrelhaDeDefesa().getGrelha()[row][col] == 8) {
                                JOptionPane.showMessageDialog(null, "Posição já acertada, escolha uma nova posição.");
                            } else {
                                x = row;
                                y = col;
                            }
                        });
                        panel.add(button);
                    }
                }
                JOptionPane.showMessageDialog(null, panel, "Grelha de Ataque", JOptionPane.PLAIN_MESSAGE);

                z = (char) (x + 'A');
                if (jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 2 || jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 8) {
                    continue;
                }
                
            } while (jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 2 || jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 8);
          
            if (jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 1) { // '1' indica um navio ja posicionado
                System.out.println("Acertou!");
                
                //jogador1.getGrelhaDeAtaque().setAcerto(x,y);
                jogador1.getAtaqueGUI().setTiro(jogador1.getGrelhaDeAtaque(),x, y, 1);
                
                //jogador2.getGrelhaDeDefesa().setAcerto(x, y);
                jogador2.getDefesaGUI().setTiro(jogador2.getGrelhaDeDefesa(),x, y, 8);
                
                if (jogador2.getGrelhaDeDefesa().naviosDestruidos()) {
                    System.out.println(jogador1.getNome() + " Vitória!");
                    gameOver = true;
                }
            }else if (jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 4) {
            	System.out.println("Acertou!");
            	
            	//jogador1.getGrelhaDeAtaque().setAcerto(x,y);
                jogador1.getAtaqueGUI().setTiro(jogador1.getGrelhaDeAtaque(),x, y, 4);
                
                //jogador2.getGrelhaDeDefesa().setAcerto(x, y);
                jogador2.getDefesaGUI().setTiro(jogador2.getGrelhaDeDefesa(),x, y, 8);
                
                if (jogador2.getGrelhaDeDefesa().naviosDestruidos()) {
                    System.out.println(jogador1.getNome() + " Vitória!");
                    gameOver = true;
            	
                }
            }else if (jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 5) {
            	System.out.println("Acertou!");
            	
            	//jogador1.getGrelhaDeAtaque().setAcerto(x,y);
                jogador1.getAtaqueGUI().setTiro(jogador1.getGrelhaDeAtaque(),x, y, 5);
                
                //jogador2.getGrelhaDeDefesa().setAcerto(x, y);
                jogador2.getDefesaGUI().setTiro(jogador2.getGrelhaDeDefesa(),x, y, 8);
                
                if (jogador2.getGrelhaDeDefesa().naviosDestruidos()) {
                    System.out.println(jogador1.getNome() + " Vitória!");
                    gameOver = true;
            	
            }
            	
            }else if (jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 6) {
            	
            	//jogador1.getGrelhaDeAtaque().setAcerto(x,y);
                jogador1.getAtaqueGUI().setTiro(jogador1.getGrelhaDeAtaque(),x, y, 6);
                
                //jogador2.getGrelhaDeDefesa().setAcerto(x, y);
                jogador2.getDefesaGUI().setTiro(jogador2.getGrelhaDeDefesa(),x, y, 8);
                
                if (jogador2.getGrelhaDeDefesa().naviosDestruidos()) {
                    System.out.println(jogador1.getNome() + " Vitória!");
                    gameOver = true;
            	
            }
            	
            }else if (jogador2.getGrelhaDeDefesa().getGrelha()[x][y] == 7) {
            	
            	//jogador1.getGrelhaDeAtaque().setAcerto(x,y);
                jogador1.getAtaqueGUI().setTiro(jogador1.getGrelhaDeAtaque(),x, y, 7);
                
                //jogador2.getGrelhaDeDefesa().setAcerto(x, y);
                jogador2.getDefesaGUI().setTiro(jogador2.getGrelhaDeDefesa(),x, y, 8);
                
                if (jogador2.getGrelhaDeDefesa().naviosDestruidos()) {
                    System.out.println(jogador1.getNome() + " Vitória!");
                    gameOver = true;
            	}
            }
                
            
            else {
                System.out.println("Errou!");
                
                //jogador1.getGrelhaDeAtaque().setErro(x,y);
                jogador1.getAtaqueGUI().setErrou(jogador1.getGrelhaDeAtaque(),x, y);
                
                //jogador2.getGrelhaDeDefesa().setErro(x,y); 
                jogador2.getDefesaGUI().setErrou(jogador2.getGrelhaDeDefesa(),x, y);
                
            }
            jogador1.getJanelaJogo().setVisible(false);


            // troca os jogadores
            Jogador atual = jogador1;
            jogador1 = jogador2;
            jogador2 = atual;
        }
        
    }
}